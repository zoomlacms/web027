@model ZoomLaCMS.Models.Product.VM_Product
@using System.Data
@{
    Layout = "~/Areas/AdminMVC/Views/Shared/_layout.cshtml";
    DataTable groupDt = (DataTable)ViewBag.groupDt;
}
@section head{
<style type="text/css">
.fd_td_l { width: 120px; }
.proclass_tab { display: none; }
#Proname { background: url(/Images/bg1.gif) repeat-x; }
#cbind_btn { display: none; }
</style>
<script charset="utf-8" src="/Plugins/Ueditor/ueditor.config.js"></script>
<script charset="utf-8" src="/Plugins/Ueditor/ueditor.all.js"></script>
<link type="text/css" href="/dist/css/bootstrap-switch.min.css" rel="stylesheet" />
<title>编辑商品</title>
}
@section content{
    <div class="container-fluid mysite" id="BreadDiv">
        <div class="row">
            <ol id="BreadNav" class="breadcrumb navbar-fixed-top">
                <li><a href='@(CustomerPageAction.customPath2)Main.aspx'>工作台</a></li>
                <li><a href='ProductManage.aspx'>商城管理</a></li>
                <li><a href='ProductManage.aspx?NodeID=@Model.nodeMod.NodeID'>@Model.nodeMod.NodeName</a></li>
                <li class='active'>@(Model.proMod.ID > 0 ? "修改" : "添加")商品</li>
                <div class='pull-right hidden-xs'><span onclick="opentitle('../Content/EditNode.aspx?NodeID=@Model.nodeMod.NodeID','配置本节点');" class='fa fa-cog' title='配置本节点' style='cursor:pointer;margin-left:5px;'></span></div>
            </ol>
        </div>
    </div>
<form method="post" action="@MVCHelper.GetAction("Product_Add",Request)">
    <ul class="nav nav-tabs">
        <li class="active"><a href="#Tabs0" data-toggle="tab">基本信息</a></li>
        <li><a href="#Tabs1" data-toggle="tab">商品说明</a></li>
        <li><a href="#Tabs2" data-toggle="tab">库存厂税</a></li>
        <li><a href="#Tabs3" data-toggle="tab">价格运费</a></li>
        <li><a href="#Tabs4" data-toggle="tab">促销推广</a></li>
        <li><a href="#Tabs5" data-toggle="tab">详细属性</a></li>
    </ul>
    <div class="tab-content panel-body padding0">
        <div id="Tabs0" class="tab-pane active manage_content">
            <table class="table table-striped table-bordered">
                <tbody>
                    <tr>
                        <td class="td_m"><strong>所属节点：</strong></td>
                        <td>
                            @Model.nodeMod.NodeName
                            <input type="hidden" id="Bind_Hid" name="Bind_Hid" value="@ViewBag.Bind_Hid" />
                            <input type="hidden" id="Group_Hid" name="Group_Hid" value="@ViewBag.Group_Hid" />
                        </td>
                    </tr>
                    <tr>
                        <td class="td_m">所属店铺：</td>
                        <td>
                            @Html.DropDownList("UserShopID",ViewBag.storelist as SelectList,Model.proMod.UserShopID.ToString(),new { @class= "form-control text_300" })
                        </td>
                    </tr>
                    <tr>
                        <td><strong>商品编号：</strong></td>
                        <td>
                            @Html.TextBox("ProCode", Model.proMod.ProCode, new { @class = "form-control text_300" })
                        </td>
                    </tr>
                    <tr>
                        <td><strong>商品名称：</strong></td>
                        <td>
                            @Html.TextBox("Proname",Model.proMod.Proname, new { @class = "form-control text_500", @onkeyup = "isgoEmpty('Proname','span_Proname');" })
                            <a href="javascript:;" title="捆绑销售" id="bind_btn" onclick="showbind();" class="btn btn-default"><i class="fa fa-link"></i></a>
                            <a href="javascript:;" title="取消捆绑" id="cbind_btn" onclick="clearbind();" class="btn btn-default"><i class="fa fa-minus"></i></a>
                            <span id="span_Proname"></span><span><span class="vaild_tip"></span></span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>短名称：</strong></td>
                        <td>
                            @Html.TextBox("ShortProName",Model.proMod.ShortProName, new { @class = "form-control text_300", @maxlength = "5" })
                            <span>(5个字符以内(如:滋养型,无硅油),为空则会自动截取商品名称前5个字符)</span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>关键字：</strong></td>
                        <td>
                            <div id="OAkeyword" style="display: inline-block; min-width: 300px;"></div>
                            @Html.TextBox("Kayword",Model.proMod.Kayword, new { @class = "form-control" })
                            <input type="hidden" id="IgnoreKey_Hid" name="IgnoreKey_Hid" />
                            <span>(空格或回车键分隔，长度不超过10字符或5汉字)</span>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>商品类型：</strong></td>
                        <td>
                            <label><input type="radio" value="1" name="proclass_rad" onclick="proclass.switch(this.value);" />正常商品</label>
                            <label><input type="radio" value="5" name="proclass_rad" onclick="proclass.switch(this.value);" />虚拟商品</label>
                            <label><input type="radio" value="2" name="proclass_rad" onclick="proclass.switch(this.value);" />特价</label>
                            <label><input type="radio" value="3" name="proclass_rad" onclick="proclass.switch(this.value);" />积分</label>
                            <label><input type="radio" value="4" name="proclass_rad" onclick="proclass.switch(this.value);" />团购</label>
                            <label><input type="radio" value="6" name="proclass_rad" onclick="proclass.switch(this.value);" />IDC</label>
                            <label><input type="radio" value="7" name="proclass_rad" onclick="proclass.switch(this.value);" />旅游</label>
                            <label><input type="radio" value="8" name="proclass_rad" onclick="proclass.switch(this.value);" />酒店</label>
                            <div class="proclass_tab" id="proclass_tab6">
                                <table class="table table-bordered table-striped" style="width:400px;">
                                    <tr><td class="td_m">期限</td><td class="td_m">价格</td><td class="td_xs"><a href="javascript:;" class="btn btn-primary" onclick="idc.addrow();"><i class="fa fa-plus"></i></a></td></tr>
                                    <tbody id="idc_list">
                                        <tr><td><input type="text" class="form-control time" value="7天" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="fa fa-minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="15天" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="fa fa-minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="1月" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="fa fa-minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="季度" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="fa fa-minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="半年" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="fa fa-minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="1年" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="fa fa-minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="2年" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="fa fa-minus"></i></a></td></tr>
                                        <tr><td><input type="text" class="form-control time" value="无限期" /></td><td><input type="text" class="form-control price" value="0" /></td><td><a href="javascript:;" class="btn btn-info" onclick="idc.del(this);"><i class="fa fa-minus"></i></a></td></tr>
                                    </tbody>
                                </table>
                                <input type="hidden" id="IDC_Hid" name="IDC_Hid" value="@Model.proMod.IDCPrice" />
                                <div class="alert alert-info">价格或期限为空则不显示,支持(天|月|年|季度|无限期)</div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>多价格：</strong></td>
                        <td>
                            <table class="table table-bordered table-striped table-hover">
                                <tbody id="child_tb">
                                    <tr class="childtr">
                                        <td>
                                            <input type="hidden" name="C_code_hid" value="@MvcHtmlString.Create("@code")" />
                                            <span>品名：<input type="text" name="C_Proname_T" class="form-control text_md" value="@MvcHtmlString.Create("@Proname")" /></span>
                                            <span>价格：<input type="text" name="C_LinPrice_T" class="form-control text_md" value="@MvcHtmlString.Create("@LinPrice")" /></span>
                                            <span>零售价：<input type="text" name="C_ShiPrice_T" class="form-control text_md" value="@MvcHtmlString.Create("@ShiPrice")" /></span>
                                            <a href="javascript:;" class="btn btn-default addchild"><i class="fa fa-plus"></i></a>
                                            <a href="javascript:;" class="btn btn-default delchild"><i class="fa fa-minus"></i></a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <asp:HiddenField runat="server" ID="ChildPro_Hid" />
                        </td>
                    </tr>
                    <tr id="bindpro_tr" hidden>
                        <td><strong>捆绑销售：</strong></td>
                        <td>
                            <div class="marginbot10">
                                <input type="button" class="btn btn-info" value="添加捆绑" onclick="OpenSelect();" />
                                <input type="button" class="btn btn-info" value="清空捆绑" onclick="ClearSelect();" />
                            </div>
                            <table id="bindpro_table" style="display: none;" class="table table-striped table-bordered">
                                <tr>
                                    <td>ID</td>
                                    <td>商品图片</td>
                                    <td>零售价</td>
                                    <td>商品名称</td>
                                </tr>
                                <tbody id="bindpro_body"></tbody>
                                <tr>
                                    <td colspan="5">
                                        <input type="button" class="btn btn-info" value="移除选定捆绑" onclick="RemoveBind();" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>商品单位：</strong></td>
                        <td>
                            @Html.TextBox("ProUnit", Model.proMod.ProUnit, new { @class = "form-control text_md" })
                            <div id="Unitd" class="btn btn-group">
                                <button type="button" class="btn btn-default">件</button>
                                <button type="button" class="btn btn-default">个</button>
                                <button type="button" class="btn btn-default">只</button>
                                <button type="button" class="btn btn-default">组</button>
                                <button type="button" class="btn btn-default">套</button>
                                <button type="button" class="btn btn-default">把</button>
                                <button type="button" class="btn btn-default">双</button>
                                <button type="button" class="btn btn-default">台</button>
                                <button type="button" class="btn btn-default">年</button>
                                <button type="button" class="btn btn-default">月</button>
                                <button type="button" class="btn btn-default">日</button>
                                <button type="button" class="btn btn-default">季</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>商品重量：</strong></td>
                        <td>
                            <div class="text_md input-group">
                                @Html.TextBox("Weight",Model.proMod.Weight, new { @class = "form-control text_md" })
                                <span class="input-group-addon">千克</span>
                            </div>
                            @*<asp:RegularExpressionValidator ID="RV12" runat="server" ControlToValidate="Weight_T" ErrorMessage="商品重量必须是数字!" ValidationExpression="^(-?\d+)(\.\d+)?$" SetFocusOnError="True" Display="Dynamic" ForeColor="Red" />*@
                        </td>
                    </tr>
                    <tr>
                        <td><strong>条形码：</strong></td>
                        <td>
                            @Html.TextBox("BarCode",Model.proMod.BarCode, new { @class = "form-control text_300 num nofocus" })
                        </td>
                    </tr>
                    <tr>
                        <td><strong>销售状态：</strong></td>
                        <td>
                            <label>@Html.CheckBox("Sales_Chk",Model.proMod.Sales == 1)打勾表示销售中，否则为停售状态</label>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>属性设置：</strong></td>
                        <td>
                            <label>@(Html.CheckBox("istrue_chk", Model.proMod.Istrue == 1))审核通过</label>
                            <label>@(Html.CheckBox("istrue_chk", Model.proMod.Isnew == 1))新品</label>
                            <label>@(Html.CheckBox("istrue_chk", Model.proMod.Ishot == 1))热销</label>
                            <label>@(Html.CheckBox("istrue_chk", Model.proMod.Isgood == 1))精品</label>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>售后设置：</strong></td>
                        <td>
                            <label><input type="checkbox" name="GuessXML" value="drawback" checked="checked" />退货</label>
                            <label><input type="checkbox" name="GuessXML" value="exchange" />换货</label>
                            <label><input type="checkbox" name="GuessXML" value="repair" />维修</label>
                            <input type="checkbox" id="restate_hid" value="@Model.proMod.GuessXML" />
                        </td>
                    </tr>
                    <tr>
                        <td><strong>会员特选：</strong></td>
                        <td>
                            <label>@(Html.CheckBox("Largess", Model.proMod.Largess == 1,new{@class="switchChk" }))特选商品</label>
                            <span class="rd_green">(设置为特选商品后,只有指定会员才可购买)</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="Tabs1" class="tab-pane">
            <table class="table table-striped table-bordered">
                <tbody>
                    <tr>
                        <td class="td_l"><strong>商品简介：</strong></td>
                        <td>
                            @Html.TextArea("Proinfo",Model.proMod.Proinfo, new { @class = "form-control m715-50", @style = "height:70px;", @placeholder = "用于首页及栏目页显示，最多255个字符" })
                        </td>
                    </tr>
                    <tr>
                        <td><strong>详细介绍：</strong></td>
                        <td>
                            @Html.TextArea("Procontent", Model.proMod.Procontent, new { @style = "width: 715px; height: 300px;" })
                            @MvcHtmlString.Create(Call.GetUEditor("Procontent", 3))
                        </td>
                    </tr>
                    <tr>
                        <td><strong>商品清晰图：</strong></td>
                        <td>
                            @Html.TextBox("Clearimg",Model.proMod.Clearimg, new { @class = "form-control text_300" })
                            <iframe id="bigimgs" style="top: 2px; width: 100%; height: 25px;" src="/Common/fileupload.aspx?FieldName=Clearimg&ModelID=@Model.ModelID&NodeID=@Model.NodeID" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"></iframe>
                        </td>
                    </tr>
                    <tr id="addsmallimg">
                        <td><strong>商品缩略图：</strong></td>
                        <td>
                            @Html.TextBox("Thumbnails",Model.proMod.Thumbnails, new { @class = "form-control text_300" })
                            <iframe id="smallimgs" style="top: 2px; width: 100%; height: 25px;" src="/Common/fileupload.aspx?FieldName=Thumbnails&ModelID=@Model.ModelID&NodeID=@Model.NodeID" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"></iframe>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>个性模板：</strong></td>
                        <td>
                            @MvcHtmlString.Create(PageCommon.GetTlpDP("ModeTemplate"))
                            <input type="hidden" id="ModeTemplate_hid" name="ModeTemplate_hid" value="@Model.proMod.ModeTemplate" />
                        </td>
                    </tr>
                    <tr>
                        <td><strong>点击数：</strong></td>
                        <td>
                            @Html.TextBox("AllClickNum",Model.proMod.AllClickNum, new { @class = "form-control  text_300" })
                        </td>
                    </tr>
                    <tr>
                        <td><strong>发布时间：</strong></td>
                        <td>
                            @Html.TextBox("AddTime",Model.proMod.AddTime, new { @class = "form-control  text_300", @onclick = "WdatePicker({ dateFmt: 'yyyy/MM/dd HH:mm' });" })
                        </td>
                    </tr>
                    <tr>
                        <td><strong>更新时间：</strong></td>
                        <td>
                            @Html.TextBox("UpdateTime",Model.proMod.UpdateTime, new { @class = "form-control  text_300", @onclick = "WdatePicker({ dateFmt: 'yyyy/MM/dd HH:mm' });" })
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="Tabs2" class="tab-pane">
            <table class="table table-striped table-bordered">
                <tbody>
                    <tr>
                        <td class="td_m"><strong>生 产 商：</strong></td>
                        <td>
                            <div class="input-group text_300">
                                @Html.TextBox("Producer",Model.proMod.Producer, new { @class = "form-control text_300" })
                                <span class="input-group-btn"><input type="button" value="选择" class="btn btn-info" onclick="SelectProducer();" /></span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>品牌/商标：</strong></td>
                        <td>
                            <div class="input-group text_300">
                                @Html.TextBox("Brand",Model.proMod.Brand, new { @class = "form-control text_300" })
                                <span class="input-group-btn">
                                    <input type="button" value="选择" class="btn btn-info" onclick="SelectBrand();" />
                                </span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>缺货时允许购买：</strong></td>
                        <td>
                            <label>@(Html.CheckBox("Allowed", Model.proMod.Allowed == 1))打勾表示缺货时允许购买， 否则缺货时不允许购买</label>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>限购数量：</strong></td>
                        <td>
                            <label><input type="radio" name="Quota_Rad" value="0" onclick="$('#Quota_EGV').hide();" checked="checked" />不设置</label>
                            <label><input type="radio" name="Quota_Rad" value="2" onclick="$('#Quota_EGV').show();" />按会员组</label>
                            <table class="table table-bordered table-striped text_405" id="Quota_EGV" style="display:none;">
                                <tr><td class="td_l">会员组</td><td>数量(0为禁止,-1不限)</td></tr>
                                @foreach (DataRow dr in groupDt.Rows)
                                {
                                    <tr><td><label>@dr["GroupName"]</label></td><td><input type="text" class="form-control Quota_Group_T" data-gid="@dr["GroupID"]" value="@ZoomLa.Common.DataConverter.CLng(dr["quota"],-1)" /></td></tr>
                                }
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>最低购买数量：</strong></td>
                        <td>
                            <label><input type="radio" name="DownQuota_Rad" value="0" onclick="$('#DownQuota_EGV').hide();" checked="checked" />不设置</label>
                            <label><input type="radio" name="DownQuota_Rad" value="2" onclick="$('#DownQuota_EGV').show();" />按会员组</label>
                            <table class="table table-bordered table-striped text_405" id="DownQuota_EGV" style="display:none;">
                                <tr><td class="td_l">会员组</td><td>数量</td></tr>
                                @foreach (DataRow dr in groupDt.Rows)
                                {
                                    <tr><td><label>@dr["GroupName"]</label></td><td><input type="text" class="form-control DownQuota_Group_T" data-gid="@dr["GroupID"]" value="@ZoomLa.Common.DataConverter.CLng(dr["downquota"],1)" /></td></tr>
                                }
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td>数量模式：</td>
                        <td>
                            @Html.TextBox("DownCar",Model.proMod.DownCar, new { @class = "form-control text_300", @style = "width:100px;" })<span class="rd_green">购买时必须为该数值的倍数</span>
                            @*<ZL:TextBox runat="server" ID="DownCar_T" CssClass="form-control text_300" ValidType="IntPostive" style="" />*@
                        </td>
                    </tr>
                    <tr>
                        <td><strong>库存数量:</strong></td>
                        <td>
                            @Html.TextBox("Stock",Model.proMod.Stock, new { @class = "form-control", @style = "width:100px;" })
                            @if (Model.proMod.ID > 0){ <a href="javascript:;" class="btn btn-info" onclick='SetStock();'>管理库存</a> }
                        </td>
                    </tr>
                    <tr>
                        <td><strong>库存报警下限：</strong></td>
                        <td>
                            @Html.TextBox("StockDown",Model.proMod.StockDown, new { @class = "form-control", @style = "100px" })
                            @*<asp:RangeValidator ID="RangeValidator4" runat="server" ControlToValidate="StockDown" ErrorMessage="库存报警下限必须是数字!" Type="Integer" SetFocusOnError="True" />*@
                        </td>
                    </tr>
                    <tr>
                        <td><strong>前台库存计算方式:</strong></td>
                        <td>
                            <label><input type="radio" name="JisuanFs" value="0" checked="checked" />实际库存</label>
                            <label><input type="radio" name="JisuanFs" value="1" />虚拟库存</label>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>税率设置:</strong></td>
                        <td>
                            <label><input type="radio" name="Rateset" value="1" checked="checked" />含税，不开发票时有税率优惠 </label>
                            <label><input type="radio" name="Rateset" value="2" />含税，不开发票时没有税率优惠</label>
                            <label><input type="radio" name="Rateset" value="3" />不含税，开发票时需要加收税费</label>
                            <label><input type="radio" name="Rateset" value="4" />不含税，开发票时不需要加收税费</label>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>商品税率:</strong></td>
                        <td>
                            <div class="input-group text_s">
                                @Html.TextBox("Rate",Model.proMod.Rate.ToString("F0"), new { @class = "form-control text_s num" })
                                <span class="input-group-addon">%</span>
                            </div>
                            @*<asp:RegularExpressionValidator ID="RegularExpressionValidator10" runat="server" ControlToValidate="Rate" ErrorMessage="商品税率必须是数字!" ValidationExpression="^(-?\d+)(\.\d+)?$" SetFocusOnError="True" />*@
                        </td>
                    </tr>
                    <tr>
                        <td><strong>商品推荐等级:</strong></td>
                        <td>
                            <label><input type="radio" name="Dengji" value="5" />★★★★★</label>
                            <label><input type="radio" name="Dengji" value="4" />★★★★</label>
                            <label><input type="radio" name="Dengji" value="3" checked="checked" />★★★</label>
                            <label><input type="radio" name="Dengji" value="2" />★★</label>
                            <label><input type="radio" name="Dengji" value="1" />★</label>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="Tabs3" class="tab-pane">
            <table class="table table-striped table-bordered">
                <tbody>
                    <tr>
                        <td class="td_l"><strong>市场价格：<span class="rd_red">*</span></strong></td>
                        <td>
                            <div class="input-group text_s">
                                @Html.TextBox("ShiPrice",Model.proMod.ShiPrice, new { @class = "form-control text_s" })<span class="input-group-addon">元</span>
                            </div>
                            @*<asp:RegularExpressionValidator ID="RegularExpressionValidator13" runat="server" ControlToValidate="ShiPrice" ErrorMessage="价格格式不对!" ValidationExpression="\d+[.]?\d*" Display="Dynamic" SetFocusOnError="True" />
                                <asp:RequiredFieldValidator ID="RequiredFieldValidator3" runat="server" ControlToValidate="ShiPrice" ErrorMessage="价格不能为空!" SetFocusOnError="True" Display="Dynamic" />*@
                        </td>
                    </tr>
                    <tr>
                        <td><strong>零售价：<span class="rd_red">*</span></strong></td>
                        <td>
                            <div class="input-group text_s">
                                @Html.TextBox("LinPrice",Model.proMod.LinPrice, new { @class = "form-control text_s" })<span class="input-group-addon">元</span>
                            </div>
                            @*<asp:RegularExpressionValidator ID="RV14" runat="server" ControlToValidate="LinPrice" ErrorMessage="零售价格式不对!" ValidationExpression="\d+[.]?\d*" Display="Dynamic" SetFocusOnError="True" />
                                <asp:RequiredFieldValidator ID="RV4" runat="server" ControlToValidate="LinPrice" Display="Dynamic" ErrorMessage="零售价不能为空!" SetFocusOnError="True" />*@
                        </td>
                    </tr>
                    <tr>
                        <td><strong>预订价格:</strong></td>
                        <td>
                            <div class="input-group text_s">
                                @Html.TextBox("BookPrice",Model.proMod.BookPrice, new { @class = "form-control text_s" })<span class="input-group-addon">元</span>
                            </div>
                            @*<asp:RegularExpressionValidator ID="REV4" runat="server" ControlToValidate="BookPrice_T" ErrorMessage="预订价格格式不正确!" ValidationExpression="\d+[.]?\d*" Display="Dynamic" SetFocusOnError="True" />*@
                            <div class="rd_green">如设定了预订价,则购买时只需支付预定金额</div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>折扣优惠:</strong></td>
                        <td>
                            <div class="input-group text_s">
                                @Html.TextBox("Recommend",Model.proMod.Recommend, new { @class = "form-control text_s num" })<span class="input-group-addon">%</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>附加售价：</strong></td>
                        <td>
                            <div id="linprice_td">
                                <div class="input-group text_405">
                                    <span class="input-group-addon">余额</span><input type="text" id="LinPrice_Purse_T" name="LinPrice_Purse_T" class="form-control text_s curprice" />
                                    <span class="input-group-addon">银币</span><input type="text" id="LinPrice_Sicon_T" name="LinPrice_Sicon_T" class="form-control text_s curprice" />
                                    <span class="input-group-addon">积分</span><input type="text" id="LinPrice_Point_T" name="LinPrice_Point_T" class="form-control text_s curprice" />
                                </div>
                                @*<asp:RegularExpressionValidator ID="RE3" runat="server" ControlToValidate="LinPrice_Purse_T" ErrorMessage="积分格式不对!" ValidationExpression="\d+[.]?\d*" Display="Dynamic" SetFocusOnError="True" />
                                    <asp:RegularExpressionValidator ID="RV8" runat="server" ControlToValidate="LinPrice_Sicon_T" ErrorMessage="余额格式不对!" ValidationExpression="\d+[.]?\d*" Display="Dynamic" SetFocusOnError="True" />
                                    <asp:RegularExpressionValidator ID="RE11" runat="server" ControlToValidate="LinPrice_Point_T" ErrorMessage="银币格式不对!" ValidationExpression="\d+[.]?\d*" Display="Dynamic" SetFocusOnError="True" />*@
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>区域价格:</strong></td>
                        <td>
                            <div class="input-group text_405">
                                <input type="text" id="region_skey_t" placeholder="请输入地区名称" class="form-control text_300" />
                                <span class="input-group-btn">
                                    <a href="javascript:;" onclick="region.search();" class="btn btn-info"><i class="fa fa-search"></i></a>
                                    <button class="btn btn-info" type="button" onclick="region.add()">设置多区域价格</button>
                                </span>
                            </div>
                            <div style="width:600px;max-height:300px;overflow-y:auto;">
                                <table class="table table-bordered table-striped margin_t5">
                                    <tr><td>区域名称</td><td>会员组|价格</td><td>操作</td></tr>
                                    <tbody id="region_div"></tbody>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>会员价:</strong></td>
                        <td>
                            <label><input type="radio" value="0" name="UserPrice_Rad" onclick="$('.user_price_div').hide();" checked="checked" />不设置</label>
                            <label><input type="radio" value="1" name="UserPrice_Rad" onclick="$('.user_price_div').hide(); $('#price_member_div').show();" />会员价</label>
                            <label><input type="radio" value="2" name="UserPrice_Rad" onclick="$('.user_price_div').hide(); $('#price_group_div').show();" />按会员组</label>
                            <span class="rd_green">为0则按原价计算</span>
                            <div id="price_member_div" style="@(Model.proMod.UserType != 1 ? "display: none;" : "")" class="input-group text_md user_price_div">
                                <span class="input-group-addon">会员价</span>
                                @Html.TextBox("UserPrice",Model.proMod.UserPrice, new { @class = "form-control" })
                                <span class="input-group-addon">元</span>
                            </div>
                            <div id="price_group_div" style="@(Model.proMod.UserType!=2?"display: none;":"")" class="user_price_div">
                                @foreach (DataRow dr in groupDt.Rows)
                                {
                                    <div class="input-group text_300 margin_t5">
                                        <span class="input-group-addon" style="min-width:100px;"><%#Eval("GroupName")%></span>
                                        <input type="text" data-gid="@dr["GroupID"]" class="form-control Price_Group_T" value="@dr["price"]" />
                                        <span class="input-group-addon">元</span>
                                    </div>
                                }
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>运费设置:</strong></td>
                        <td>
                            <div>
                                @*<asp:RadioButtonList runat="server" ID="FareTlp_Rad" DataTextField="TlpName" DataValueField="ID" RepeatDirection="Horizontal" RepeatColumns="5"></asp:RadioButtonList>*@
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="Tabs4" class="tab-pane">
            <table class="table table-striped table-bordered">
                <tbody>
                    <tr>
                        <td class="td_l">单品组合：</td>
                        <td>
                            <div id="grouppro_td" style="max-height:300px;overflow-y:auto;"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>赠送积分：</td>
                        <td>
                            <asp:TextBox ID="PointVal_T" runat="server" Text="0" class="form-control text_s" />
                            <asp:RegularExpressionValidator ID="REV2" runat="server" ControlToValidate="PointVal_T" ErrorMessage="积分值必须是数字!" ValidationExpression="^(-?\d+)(\.\d+)?$" SetFocusOnError="True" />
                        </td>
                    </tr>
                    <tr>
                        <td>特选商品：</td>
                        <td>
                            <input type="button" value="选择用户" onclick="user.sel('uprobind', 'user');" class="btn btn-info" />
                            <input type="hidden" id="uprouids_hid" name="uprouids_hid" value="@ViewBag.uprouids" />
                            <input type="hidden" id="uprouids_old_hid" name="uprouids_old_hid" value="@ViewBag.uprouids" />
                            <div id="upro_wrap"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <script>
                $("#grouppro_td").load("/common/comp/GroupPro.aspx?ID=@Model.proMod.ParentID");
                var upro = {
                    del: function (btn, uid) {
                        $(btn).closest("tr").remove();
                        var ids = idshelp.del($("#uprouids_hid").val(), uid);
                        $("#uprouids_hid").val(ids);
                        upro.render();
                    },
                    init: function () {
                        user.hook["uprobind"] = function (list, select) {
                            var ids = list.GetIDS("UserID");
                            ids = idshelp.merge($("#uprouids_hid").val(), ids);
                            $("#uprouids_hid").val(ids);
                            upro.render();
                            CloseDiag();
                        }
                        upro.render();
                    },
                    render: function () {
                        $("#upro_wrap").load("/common/comp/UserList.aspx?del=upro.del", { "ids": $("#uprouids_hid").val() });
                    }
                };
                $(function () { upro.init(); })
            </script>
        </div>
        <div id="Tabs5" class="tab-pane">
            <table class="table table-striped table-bordered">
                <tbody>
                    @MvcHtmlString.Create(ViewBag.ModelHtml)
                </tbody>
            </table>
        </div>
    </div>
</form>
}
@section script{
<script src="/dist/js/bootstrap-switch.js"></script>
<script src="/JS/Common.js"></script>
<script src="/JS/DatePicker/WdatePicker.js"></script>
<script src="/JS/Controls/ZL_Dialog.js"></script>
<script src="/JS/Controls/ZL_Array.js"></script>
<script src="/JS/ZL_Regex.js"></script>
<script src="/JS/ZL_Content.js"></script>
<script src="/JS/Modal/shop.js?v=3"></script>
<script src="/JS/Modal/APIResult.js"></script>
<script src="/JS/SelectCheckBox.js"></script>
<script>
    var diag = new ZL_Dialog();
    //捆绑商品操作
    function BindPro(projson) {
        if (projson) { $("#Bind_Hid").val(projson); }
        if ($("#Bind_Hid").val() == "") { $("#bindpro_body").html(""); return; }
        $(".td_binddata").remove();//清空之前捆绑数据
        var proattr = [];
        try { proattr = JSON.parse($("#Bind_Hid").val()); } catch (ex) { }
        var trtlp = "<tr class='td_binddata'><td class='td_s'><label><input type='checkbox' name='bind_chk' value='@@id'>@@id</label></td><td class='td_m'><img onerror=\"shownopic(this);\" style='width:60px;height:45px;' src='/@@Thumbnails' /></td><td class='td_m'>@@LinPrice</td><td>@@Proname</td></tr>";
        var html = JsonHelper.FillData(trtlp, proattr);
        $("#bindpro_body").append(html);
        $("#bindpro_table").show();
        showbind();
    }
    //移除选定捆绑
    function RemoveBind() {
        var $chks = $("input[name=bind_chk]:checked");
        if ($chks.length < 1) { alert("请先选中需要清除的捆绑"); return false; }
        var bindArr = JSON.parse($("#Bind_Hid").val());
        $chks.each(function () {
            bindArr.RemoveByID($(this).val());
        });
        if (bindArr.length < 1) { $("#Bind_Hid").val(""); }
        else { $("#Bind_Hid").val(JSON.stringify(bindArr)); }
        BindPro();
    }
    function OpenSelect() {
        diag.title = "添加捆绑商品";
        diag.maxbtn = false;
        diag.width = "none";
        diag.url = "/Common/AddbindPro.aspx?id=<%:ProID %>&filter=admin";
        diag.ShowModal();
        return false;
    }
    function ClearSelect() {
        $("#Bind_Hid").val("");
        $("#bindpro_body").html("");
        $("#bindpro_table").hide();
    }
    function showbind() {
        $("#bindpro_tr").show();
        $("#bind_btn").hide();
        $("#cbind_btn").show();
    }
    function clearbind() {
        ClearSelect();
        $("#bindpro_tr").hide();
        $("#bind_btn").show();
        $("#cbind_btn").hide();
    }
    //选择
    function SelectProducer() {
        window.open('Producerlist.aspx', '', 'width=600,height=450,resizable=0,scrollbars=yes');
    }
    function ProductsSelect(act) {
        window.open('ProductsSelect.aspx?act=' + act, '', 'width=600,height=450,resizable=0,scrollbars=yes');
    }
    function OpenprojectSelect() {
        window.open('projectSelect.aspx', '', 'width=600,height=450,resizable=0,scrollbars=yes');
        return false;
    }
    function SelectBrand() {
        window.open('Brandlist.aspx?producer=' + document.getElementById('Producer').value + '', '', 'width=600,height=450,resizable=0,scrollbars=yes');
    }
    function CloseDiag() {
        diag.CloseModal();
        comdiag.CloseModal();
    }

    function SetStock(pid) {
        diag.url = "Stock/Stock.aspx?action=addpro&pid=<%=ProID %>";
        diag.title = "库存管理";
        diag.maxbtn = false;
        diag.reload = true;
        diag.backdrop = true;
        diag.ShowModal();
    }
    function addStock(pronum) {
        CloseDiag();
        var num = parseInt($("#Stock").val());
        $("#Stock").val(pronum + num);
    }
    //-------------------------------------------------------
    var group = { list: JSON.parse($("#Group_Hid").val()) }
    group.getName = function (gid) {
        var model = group.list.GetByID(gid, "GroupID");
        if (!model) { return "未匹配"; }
        else { return model.GroupName; }
    }
    //--------------------多区域价格(增加筛选搜索,增加为0不显示)
    var region = { guid: "<%:ProGuid%>" };
    region.fill = function (list) {
        var tlp = '<tr><td>@@region</td><td class="price_td"></td><td>';
        tlp += '<a href="javascript:;" onclick="region.edit(\'@@region\');" class="btn btn-xs btn-info">修改</a>';
        tlp += '<a href="javascript:;" onclick="region.del(this,\'@@region\');" class="btn btn-xs btn-info" style="margin-left:5px;">删除</a>';
        tlp += '</td></tr>';
        var priceTlp = "<div><span>@@gname</span> | <span>@@price</span></div>";
        $div = $("#region_div"); $div.html("");
        $items = JsonHelper.FillItem(tlp, list, function ($item, model) {
            for (var i = 0; i < model.price.length; i++) {
                model.price[i]["gname"] = group.getName(model.price[i].gid);
            }
            var priceItems = JsonHelper.FillItem(priceTlp, model.price);
            $item.find(".price_td").append(priceItems);
        });
        $div.append($items);
    }
    region.add = function () {
        comdiag.reload = true;
        ShowComDiag("Diag/RegionPrice.aspx?guid=<%=ProGuid %>", "多区域价格");
    }
    region.edit = function (region) {
        ShowComDiag("Diag/EditRegionPrice.aspx?guid=" + this.guid + "&region=" + escape(region), "区域价格管理");
    }
    region.del = function (obj, region) {
        $(obj).closest("tr").remove();
        $.post("Diag/RegionPrice.aspx?action=del&guid=" + this.guid + "&region=" + escape(region), {}, function (data) {
            var model = APIResult.getModel(data);
            if (!APIResult.isok(model)) { console.log(model.retmsg); }
        });
    }
    region.search = function () {
        var skey = $("#region_skey_t").val();
        if (ZL_Regex.isEmpty(skey)) { $("#region_div tr").show(); }
        else {
            $("#region_div tr").hide();
            $("#region_div tr:contains('" + skey + "')").show();
        }
    }
    UserFunc = null;
</script>
}
